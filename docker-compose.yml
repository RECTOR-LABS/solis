name: solis

services:
  web:
    image: ghcr.io/rector-labs/solis:latest
    container_name: solis-web
    restart: unless-stopped
    ports:
      - "8001:3001"
    environment:
      - NODE_ENV=production
      - REPORTS_DIR=/app/reports
      - DATA_DIR=/app/data
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - QUERY_API_MODEL=${QUERY_API_MODEL}
      - RESEND_API_KEY=${RESEND_API_KEY}
      - DIGEST_FROM_EMAIL=${DIGEST_FROM_EMAIL}
      - DIGEST_UNSUBSCRIBE_SECRET=${DIGEST_UNSUBSCRIBE_SECRET}
      - DIGEST_API_SECRET=${DIGEST_API_SECRET}
      - ENABLE_X402=${ENABLE_X402}
      - X402_RECEIVER_ADDRESS=${X402_RECEIVER_ADDRESS}
      - X402_PRICE_CENTS=${X402_PRICE_CENTS}
    volumes:
      - /home/solis/solis/reports:/app/reports:ro
      - /home/solis/solis/data:/app/data:rw
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.5'
        reservations:
          memory: 256M
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:3001/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
